#!/bin/bash -e

# If running the rails server then create or migrate existing database
if [ "${@: -2:1}" == "./bin/rails" ] && [ "${@: -1:1}" == "server" ]; then
  ./bin/rails db:prepare
fi

# Ensure the Rails container uses shared holotree paths (same as rccremote service).
if command -v rcc >/dev/null 2>&1; then
  rcc holotree shared -e >/dev/null 2>&1 || true
  rcc holotree init >/dev/null 2>&1 || true
fi

exec "${@}"
